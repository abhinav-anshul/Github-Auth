{"version":3,"file":"index.js","sources":["../dist-src/get-app-authentication.js","../dist-src/cache.js","../dist-src/to-token-authentication.js","../dist-src/get-installation-authentication.js","../dist-src/get-oauth-authentication.js","../dist-src/auth.js","../dist-src/requires-app-auth.js","../dist-src/hook.js","../dist-src/version.js","../dist-src/index.js"],"sourcesContent":["import { githubAppJwt } from \"universal-github-app-jwt\";\nexport async function getAppAuthentication(id, privateKey) {\n    const appAuthentication = await githubAppJwt({ id, privateKey });\n    return {\n        type: \"app\",\n        token: appAuthentication.token,\n        appId: appAuthentication.appId,\n        expiresAt: new Date(appAuthentication.expiration * 1000).toISOString(),\n    };\n}\n","// https://github.com/isaacs/node-lru-cache#readme\nimport LRU from \"lru-cache\";\nexport function getCache() {\n    return new LRU({\n        // cache max. 15000 tokens, that will use less than 10mb memory\n        max: 15000,\n        // Cache for 1 minute less than GitHub expiry\n        maxAge: 1000 * 60 * 59,\n    });\n}\nexport async function get(cache, options) {\n    const cacheKey = optionsToCacheKey(options);\n    const result = await cache.get(cacheKey);\n    if (!result) {\n        return;\n    }\n    const [token, expiresAt, repositorySelection, permissionsString, singleFileName,] = result.split(\"|\");\n    const permissions = options.permissions ||\n        permissionsString.split(/,/).reduce((permissions, string) => {\n            if (/!$/.test(string)) {\n                permissions[string.slice(0, -1)] = \"write\";\n            }\n            else {\n                permissions[string] = \"read\";\n            }\n            return permissions;\n        }, {});\n    return {\n        token,\n        expiresAt,\n        permissions,\n        repositoryIds: options.repositoryIds,\n        singleFileName,\n        repositorySelection: repositorySelection,\n    };\n}\nexport async function set(cache, options, data) {\n    const cacheKey = optionsToCacheKey(options);\n    const permissionsString = options.permissions\n        ? \"\"\n        : Object.keys(data.permissions)\n            .map((name) => `${name}${data.permissions[name] === \"write\" ? \"!\" : \"\"}`)\n            .join(\",\");\n    await cache.set(cacheKey, [\n        data.token,\n        data.expiresAt,\n        data.repositorySelection,\n        permissionsString,\n        data.singleFileName,\n    ]\n        .join(\"|\")\n        .replace(/\\|+$/, \"\"));\n}\nfunction optionsToCacheKey({ installationId, permissions = {}, repositoryIds = [], }) {\n    const permissionsString = Object.keys(permissions)\n        .sort()\n        .map((name) => (permissions[name] === \"read\" ? name : `${name}!`))\n        .join(\",\");\n    const repositoryIdsString = repositoryIds.sort().join(\",\");\n    return [installationId, repositoryIdsString, permissionsString]\n        .filter(Boolean)\n        .join(\"|\");\n}\n","export function toTokenAuthentication({ installationId, token, expiresAt, repositorySelection, permissions, repositoryIds, singleFileName, }) {\n    return Object.assign({\n        type: \"token\",\n        tokenType: \"installation\",\n        token,\n        installationId,\n        permissions,\n        expiresAt,\n        repositorySelection,\n    }, repositoryIds ? { repositoryIds } : null, singleFileName ? { singleFileName } : null);\n}\n","import { get, set } from \"./cache\";\nimport { getAppAuthentication } from \"./get-app-authentication\";\nimport { toTokenAuthentication } from \"./to-token-authentication\";\nexport async function getInstallationAuthentication(state, options, customRequest) {\n    const installationId = (options.installationId ||\n        state.installationId);\n    if (!options.refresh) {\n        const result = await get(state.cache, options);\n        if (result) {\n            const { token, expiresAt, permissions, repositoryIds, singleFileName, repositorySelection, } = result;\n            return toTokenAuthentication({\n                installationId,\n                token,\n                expiresAt,\n                permissions,\n                repositorySelection,\n                repositoryIds,\n                singleFileName,\n            });\n        }\n    }\n    const appAuthentication = await getAppAuthentication(state.id, state.privateKey);\n    const request = customRequest || state.request;\n    const { data: { token, expires_at: expiresAt, repositories, permissions, \n    // @ts-ignore\n    repository_selection: repositorySelection, \n    // @ts-ignore\n    single_file: singleFileName, }, } = await request(\"POST /app/installations/:installation_id/access_tokens\", {\n        installation_id: installationId,\n        repository_ids: options.repositoryIds,\n        permissions: options.permissions,\n        mediaType: {\n            previews: [\"machine-man\"],\n        },\n        headers: {\n            authorization: `bearer ${appAuthentication.token}`,\n        },\n    });\n    const repositoryIds = repositories\n        ? repositories.map((r) => r.id)\n        : void 0;\n    await set(state.cache, options, {\n        token,\n        expiresAt,\n        repositorySelection,\n        permissions,\n        repositoryIds,\n        singleFileName,\n    });\n    return toTokenAuthentication({\n        installationId,\n        token,\n        expiresAt,\n        repositorySelection,\n        permissions,\n        repositoryIds,\n        singleFileName,\n    });\n}\n","import { RequestError } from \"@octokit/request-error\";\nexport async function getOAuthAuthentication(state, options, customRequest) {\n    const request = customRequest || state.request;\n    // The \"/login/oauth/access_token\" is not part of the REST API hosted on api.github.com,\n    // instead itâ€™s using the github.com domain.\n    const route = /^https:\\/\\/(api\\.)?github\\.com$/.test(state.request.endpoint.DEFAULTS.baseUrl)\n        ? \"POST https://github.com/login/oauth/access_token\"\n        : `POST ${state.request.endpoint.DEFAULTS.baseUrl.replace(\"/api/v3\", \"/login/oauth/access_token\")}`;\n    const parameters = {\n        headers: {\n            accept: `application/json`,\n        },\n        client_id: state.clientId,\n        client_secret: state.clientSecret,\n        code: options.code,\n        state: options.state,\n        redirect_uri: options.redirectUrl,\n    };\n    const response = await request(route, parameters);\n    if (response.data.error !== undefined) {\n        throw new RequestError(`${response.data.error_description} (${response.data.error})`, response.status, {\n            headers: response.headers,\n            request: request.endpoint(route, parameters),\n        });\n    }\n    const { data: { access_token: token, scope }, } = response;\n    return {\n        type: \"token\",\n        tokenType: \"oauth\",\n        token,\n        scopes: scope.split(/,\\s*/).filter(Boolean),\n    };\n}\n","import { getAppAuthentication } from \"./get-app-authentication\";\nimport { getInstallationAuthentication } from \"./get-installation-authentication\";\nimport { getOAuthAuthentication } from \"./get-oauth-authentication\";\nexport async function auth(state, options) {\n    if (options.type === \"app\") {\n        return getAppAuthentication(state.id, state.privateKey);\n    }\n    if (options.type === \"installation\") {\n        return getInstallationAuthentication(state, options);\n    }\n    return getOAuthAuthentication(state, options);\n}\n","const PATHS = [\n    \"/app\",\n    \"/app/installations\",\n    \"/app/installations/:installation_id\",\n    \"/app/installations/:installation_id\",\n    \"/app/installations/:installation_id/access_tokens\",\n    \"/orgs/:org/installation\",\n    \"/orgs/:org/installation\",\n    \"/repos/:owner/:repo/installation\",\n    \"/repos/:owner/:repo/installation\",\n    \"/users/:username/installation\",\n    \"/users/:username/installation\",\n];\n// CREDIT: Simon Grondin (https://github.com/SGrondin)\n// https://github.com/octokit/plugin-throttling.js/blob/45c5d7f13b8af448a9dbca468d9c9150a73b3948/lib/route-matcher.js\nfunction routeMatcher(paths) {\n    // EXAMPLE. For the following paths:\n    /* [\n        \"/orgs/:org/invitations\",\n        \"/repos/:owner/:repo/collaborators/:username\"\n    ] */\n    const regexes = paths.map((p) => p\n        .split(\"/\")\n        .map((c) => (c.startsWith(\":\") ? \"(?:.+?)\" : c))\n        .join(\"/\"));\n    // 'regexes' would contain:\n    /* [\n        '/orgs/(?:.+?)/invitations',\n        '/repos/(?:.+?)/(?:.+?)/collaborators/(?:.+?)'\n    ] */\n    const regex = `^(?:${regexes.map((r) => `(?:${r})`).join(\"|\")})[^/]*$`;\n    // 'regex' would contain:\n    /*\n      ^(?:(?:\\/orgs\\/(?:.+?)\\/invitations)|(?:\\/repos\\/(?:.+?)\\/(?:.+?)\\/collaborators\\/(?:.+?)))[^\\/]*$\n  \n      It may look scary, but paste it into https://www.debuggex.com/\n      and it will make a lot more sense!\n    */\n    return new RegExp(regex, \"i\");\n}\nconst REGEX = routeMatcher(PATHS);\nexport function requiresAppAuth(url) {\n    return !!url && REGEX.test(url);\n}\n","import { getAppAuthentication } from \"./get-app-authentication\";\nimport { getInstallationAuthentication } from \"./get-installation-authentication\";\nimport { requiresAppAuth } from \"./requires-app-auth\";\nexport async function hook(state, request, route, parameters) {\n    let endpoint = request.endpoint.merge(route, parameters);\n    if (requiresAppAuth(endpoint.url.replace(request.endpoint.DEFAULTS.baseUrl, \"\"))) {\n        const { token } = await getAppAuthentication(state.id, state.privateKey);\n        endpoint.headers.authorization = `bearer ${token}`;\n        return request(endpoint);\n    }\n    const { token } = await getInstallationAuthentication(state, {}, request);\n    endpoint.headers.authorization = `token ${token}`;\n    return request(endpoint);\n}\n","export const VERSION = \"2.4.5\";\n","import { getUserAgent } from \"universal-user-agent\";\nimport { request } from \"@octokit/request\";\nimport { auth } from \"./auth\";\nimport { hook } from \"./hook\";\nimport { getCache } from \"./cache\";\nimport { VERSION } from \"./version\";\nexport const createAppAuth = function createAppAuth(options) {\n    const state = Object.assign({\n        request: request.defaults({\n            headers: {\n                \"user-agent\": `octokit-auth-app.js/${VERSION} ${getUserAgent()}`,\n            },\n        }),\n        cache: getCache(),\n    }, options);\n    return Object.assign(auth.bind(null, state), {\n        hook: hook.bind(null, state),\n    });\n};\n"],"names":["getAppAuthentication","id","privateKey","appAuthentication","githubAppJwt","type","token","appId","expiresAt","Date","expiration","toISOString","getCache","LRU","max","maxAge","get","cache","options","cacheKey","optionsToCacheKey","result","repositorySelection","permissionsString","singleFileName","split","permissions","reduce","string","test","slice","repositoryIds","set","data","Object","keys","map","name","join","replace","installationId","sort","repositoryIdsString","filter","Boolean","toTokenAuthentication","assign","tokenType","getInstallationAuthentication","state","customRequest","refresh","request","expires_at","repositories","repository_selection","single_file","installation_id","repository_ids","mediaType","previews","headers","authorization","r","getOAuthAuthentication","route","endpoint","DEFAULTS","baseUrl","parameters","accept","client_id","clientId","client_secret","clientSecret","code","redirect_uri","redirectUrl","response","error","undefined","RequestError","error_description","status","access_token","scope","scopes","auth","PATHS","routeMatcher","paths","regexes","p","c","startsWith","regex","RegExp","REGEX","requiresAppAuth","url","hook","merge","VERSION","createAppAuth","defaults","getUserAgent","bind"],"mappings":"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"}